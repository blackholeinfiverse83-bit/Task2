# Backend Integration Guide

This guide is for the backend developer to understand how to integrate with the Blackhole Infiverse Frontend.

## 1. API Configuration

The frontend expects the backend to be running on address defined in the environment variables.

### Environment Variables (.env.local)

These are the key environment variables used by the frontend to connect to the backend:

```env
# URL for the unified backend service
NEXT_PUBLIC_NOOPUR_API_BASE=http://localhost:8000

# URL for the Sankalp Insight Node service (can be the same as unified backend)
NEXT_PUBLIC_SANKALP_API_BASE=http://localhost:8000

# Base URL for serving static audio files
NEXT_PUBLIC_AUDIO_BASE_URL=http://localhost:8000/data/audio
```

## 2. API Endpoints

The frontend consumes the following endpoints. Please ensure your backend implements them or proxies them correctly.

### Core Endpoints

*   **`GET /health`**
    *   **Purpose**: Check if backend is online.
    *   **Expected Response**: `{ "status": "healthy" }`

*   **`POST /api/unified-news-workflow`**
    *   **Purpose**: Main pipeline for scraping, vetting, summarizing, and generating assets.
    *   **Input**: `{ "url": "https://example.com/news" }`
    *   **Expected Response**: `WorkflowResult` (see `lib/api.ts` for full interface).

### Tool-Specific Endpoints (Testing)

These are used in the "Advanced" tab to test individual components.

*   `POST /api/scrape`
*   `POST /api/vet`
*   `POST /api/summarize`
*   `POST /api/prompt`
*   `POST /api/video-search`
*   `POST /api/validate-video`

### Sankalp (Insight Node) Integration

The dashboard attempts to fetch synthesized news reports from the "Sankalp" system.

*   **`GET /exports/weekly_report.json`**
    *   **Purpose**: Fetch the main feed of processed news items.
    *   **Note**: The frontend currently expects this file to be served statically from the backend.

*   **`GET /exports/sample_integration.json`**
    *   **Purpose**: Fallback feed if weekly report is missing.

*   **`POST /feedback`**
    *   **Purpose**: Submit RLHF (Reinforcement Learning from Human Feedback) signals.
    *   **Input**: `{ "id": "item_id", "signals": { "user_like": true } }`

*   **`POST /requeue`**
    *   **Purpose**: Request re-processing of a specific news item.
    *   **Input**: `{ "id": "item_id" }`

## 3. Static File Serving

The frontend attempts to play audio files generated by the backend.

*   **Expected Path**: `/data/audio/{filename}.wav`
*   The backend MUST serve static files from the `sankalp-insight-node/data` directory at the `/data` route.

## 4. Authentication (Mocked)

Currently, authentication headers are built in `lib/security.ts`.
*   It uses `NEXT_PUBLIC_JWT_TOKEN` and `NEXT_PUBLIC_HMAC_SECRET`.
*   These are currently set to "sample_token" and "sample_secret".
*   **Action Required**: Implement actual JWT validation if production security is needed.

## 5. Deployment

When deploying to production (e.g. Render):

1.  Set `NEXT_PUBLIC_NOOPUR_API_BASE` to your real backend URL.
2.  Set `NEXT_PUBLIC_SANKALP_API_BASE` to your real backend URL.
3.  Ensure the backend Dockerfile or start script mounts the `sankalp-insight-node` directory correctly so static files can be served.
